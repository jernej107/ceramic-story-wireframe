<!-- Product Page Template -->
<div class="product-page">
  
  <!-- Breadcrumb Navigation -->
  <nav class="breadcrumb" style="margin-bottom: 2rem;">
    <ol style="display: flex; list-style: none; gap: 0.5rem; color: var(--muted-foreground);">
      <li><a href="{{ store.url }}" style="color: var(--muted-foreground); text-decoration: none;">Home</a></li>
      <li>/</li>
      <li><a href="{{ store.url }}/products" style="color: var(--muted-foreground); text-decoration: none;">Products</a></li>
      {% if product.category %}
        <li>/</li>
        <li><a href="{{ store.url }}/category/{{ product.category.permalink }}" style="color: var(--muted-foreground); text-decoration: none;">{{ product.category.name }}</a></li>
      {% endif %}
      <li>/</li>
      <li style="color: var(--foreground);">{{ product.name }}</li>
    </ol>
  </nav>

  <!-- Product Details -->
  <div class="product-details" style="display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; margin-bottom: 4rem;">
    
    <!-- Product Images -->
    <div class="product-images">
      {% if product.images.size > 0 %}
        <div class="main-image" style="margin-bottom: 1rem;">
          <img id="main-product-image" 
               src="{{ product.images.first | product_image_url: 'large' }}" 
               alt="{{ product.name }}"
               style="width: 100%; height: 500px; object-fit: cover; border-radius: var(--radius); box-shadow: var(--shadow-soft);">
        </div>
        
        {% if product.images.size > 1 %}
          <div class="image-thumbnails" style="display: flex; gap: 0.5rem; overflow-x: auto;">
            {% for image in product.images %}
              <img src="{{ image | product_image_url: 'thumb' }}" 
                   alt="{{ product.name }}"
                   class="thumbnail"
                   onclick="changeMainImage('{{ image | product_image_url: 'large' }}')"
                   style="width: 80px; height: 80px; object-fit: cover; border-radius: var(--radius); cursor: pointer; transition: var(--transition-ceramic); border: 2px solid transparent;">
            {% endfor %}
          </div>
        {% endif %}
      {% else %}
        <div style="width: 100%; height: 500px; background: var(--muted); border-radius: var(--radius); display: flex; align-items: center; justify-content: center; color: var(--muted-foreground);">
          No Image Available
        </div>
      {% endif %}
    </div>

    <!-- Product Information -->
    <div class="product-info">
      <header class="product-header" style="margin-bottom: 2rem;">
        <h1 style="font-size: 2.5rem; font-weight: 600; margin-bottom: 1rem;">{{ product.name }}</h1>
        
        <div class="product-price" style="font-size: 1.5rem; font-weight: 600; color: var(--primary); margin-bottom: 1rem;">
          {% if product.on_sale %}
            <span style="text-decoration: line-through; color: var(--muted-foreground); font-size: 1.25rem;">
              {{ product.default_price | money_with_currency }}
            </span>
            <span style="color: var(--destructive); margin-left: 0.5rem;">
              {{ product.min_price | money_with_currency }}
            </span>
            <span style="background: var(--destructive); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; margin-left: 0.5rem;">
              SALE
            </span>
          {% else %}
            {% if product.min_price != product.max_price %}
              From {{ product.min_price | money_with_currency }}
            {% else %}
              {{ product.default_price | money_with_currency }}
            {% endif %}
          {% endif %}
        </div>
        
        {% if product.status == 'sold-out' %}
          <div style="background: var(--muted); color: var(--muted-foreground); padding: 0.5rem 1rem; border-radius: var(--radius); display: inline-block; margin-bottom: 1rem;">
            Sold Out
          </div>
        {% endif %}
      </header>

      <!-- Product Description -->
      {% if product.description %}
        <div class="product-description" style="margin-bottom: 2rem;">
          <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Description</h3>
          <div style="color: var(--muted-foreground); line-height: 1.6;">
            {{ product.description | paragraphs }}
          </div>
        </div>
      {% endif %}

      <!-- Product Form -->
      {% unless product.status == 'sold-out' %}
        <form action="{{ store.url }}/cart" method="post" class="product-form" style="background: var(--card); padding: 2rem; border-radius: var(--radius); border: 1px solid var(--border);">
          
          <!-- Product Options -->
          {% if product.has_default_option %}
            <input type="hidden" name="id" value="{{ product.default_option.id }}">
          {% else %}
            <div class="product-options" style="margin-bottom: 1.5rem;">
              {% for option in product.options %}
                <div class="product-option">
                  <label class="form-label">
                    {{ option.name }}
                    {% if option.has_custom_price %}
                      ({{ option.price | money_with_currency }})
                    {% endif %}
                  </label>
                  <select name="id" class="form-select" required>
                    <option value="">Choose {{ option.name }}</option>
                    {% for choice in option.choices %}
                      <option value="{{ choice.id }}" {% if choice.sold_out %}disabled{% endif %}>
                        {{ choice.name }}
                        {% if choice.has_custom_price %}
                          - {{ choice.price | money_with_currency }}
                        {% endif %}
                        {% if choice.sold_out %} (Sold Out){% endif %}
                      </option>
                    {% endfor %}
                  </select>
                </div>
              {% endfor %}
            </div>
          {% endif %}

          <!-- Quantity -->
          <div class="quantity-group" style="margin-bottom: 1.5rem;">
            <label class="form-label">Quantity</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <button type="button" onclick="changeQuantity(-1)" class="btn btn-outline" style="width: 40px; height: 40px; padding: 0;">-</button>
              <input type="number" name="quantity" value="1" min="1" max="10" class="quantity-input form-input" style="width: 80px; text-align: center;">
              <button type="button" onclick="changeQuantity(1)" class="btn btn-outline" style="width: 40px; height: 40px; padding: 0;">+</button>
            </div>
          </div>

          <!-- Add to Cart Button -->
          <button type="submit" class="btn btn-primary" style="width: 100%; font-size: 1.125rem; padding: 1rem;">
            <span class="loading-text">Add to Cart</span>
            <span class="spinner" style="display: none;"></span>
          </button>
        </form>
      {% endunless %}

      <!-- Product Details -->
      <div class="product-details-section" style="margin-top: 2rem;">
        <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Product Details</h3>
        <div style="color: var(--muted-foreground); line-height: 1.6;">
          <p><strong>Handcrafted:</strong> Each piece is uniquely made by hand</p>
          <p><strong>Material:</strong> High-quality ceramic clay</p>
          <p><strong>Care:</strong> Hand wash recommended, microwave and dishwasher safe</p>
          {% if product.category %}
            <p><strong>Collection:</strong> {{ product.category.name }}</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Related Products -->
  {% assign related_products = product.category.products | where: 'id', '!=', product.id %}
  {% if related_products.size > 0 %}
    <section class="related-products" style="margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border);">
      <h2 style="font-size: 2rem; font-weight: 600; margin-bottom: 2rem; text-align: center;">Related Products</h2>
      
      <div class="products-grid">
        {% for related_product in related_products limit: 4 %}
          <div class="product-card">
            <a href="{{ store.url }}/product/{{ related_product.permalink }}">
              {% if related_product.images.size > 0 %}
                <img src="{{ related_product.images.first | product_image_url: 'medium' }}" 
                     alt="{{ related_product.name }}" 
                     class="product-image">
              {% else %}
                <div class="product-image" style="background: var(--muted); display: flex; align-items: center; justify-content: center; color: var(--muted-foreground);">
                  No Image
                </div>
              {% endif %}
              
              <h3 class="product-title">{{ related_product.name }}</h3>
              <div class="product-price">{{ related_product.default_price | money_with_currency }}</div>
            </a>
          </div>
        {% endfor %}
      </div>
    </section>
  {% endif %}

</div>

<!-- Product Page Styles -->
<style>
  .thumbnail:hover,
  .thumbnail.active {
    border-color: var(--primary) !important;
    transform: scale(1.05);
  }
  
  .product-form {
    box-shadow: var(--shadow-soft);
  }
  
  @media (max-width: 768px) {
    .product-details {
      grid-template-columns: 1fr !important;
      gap: 2rem !important;
    }
    
    .product-page h1 {
      font-size: 2rem !important;
    }
    
    .main-image img {
      height: 400px !important;
    }
  }
</style>

<!-- Product Page JavaScript -->
<script>
  // Change main product image
  function changeMainImage(imageUrl) {
    const mainImage = document.getElementById('main-product-image');
    const thumbnails = document.querySelectorAll('.thumbnail');
    
    if (mainImage) {
      mainImage.src = imageUrl;
    }
    
    // Update active thumbnail
    thumbnails.forEach(thumb => {
      thumb.classList.remove('active');
      if (thumb.src.includes(imageUrl.split('/').pop().split('?')[0])) {
        thumb.classList.add('active');
      }
    });
  }

  // Quantity controls
  function changeQuantity(change) {
    const quantityInput = document.querySelector('.quantity-input');
    if (quantityInput) {
      let currentValue = parseInt(quantityInput.value) || 1;
      let newValue = currentValue + change;
      
      if (newValue >= 1 && newValue <= 10) {
        quantityInput.value = newValue;
      }
    }
  }

  // Form submission handling
  document.addEventListener('DOMContentLoaded', function() {
    const productForm = document.querySelector('.product-form');
    
    if (productForm) {
      productForm.addEventListener('submit', function(e) {
        const submitButton = productForm.querySelector('button[type="submit"]');
        const loadingText = submitButton.querySelector('.loading-text');
        const spinner = submitButton.querySelector('.spinner');
        
        if (submitButton && loadingText && spinner) {
          loadingText.textContent = 'Adding...';
          spinner.style.display = 'inline-block';
          submitButton.disabled = true;
          
          // Re-enable after submission
          setTimeout(() => {
            loadingText.textContent = 'Add to Cart';
            spinner.style.display = 'none';
            submitButton.disabled = false;
            
            if (window.showCartNotification) {
              window.showCartNotification();
            }
          }, 1000);
        }
      });
    }
    
    // Set first thumbnail as active
    const firstThumbnail = document.querySelector('.thumbnail');
    if (firstThumbnail) {
      firstThumbnail.classList.add('active');
    }
  });
</script>